{"version":3,"sources":["../../src/middlewares/auth.middleware.ts"],"sourcesContent":["import { NextFunction, Response } from 'express';\nimport { verify } from 'jsonwebtoken';\nimport { SECRET_KEY } from '@config';\nimport { HttpException } from '@exceptions/HttpException';\nimport { DataStoredInToken, RequestWithUser } from '@interfaces/auth.interface';\nimport userModel from '@models/users.model';\n\nconst authMiddleware = async (req: RequestWithUser, res: Response, next: NextFunction) => {\n  try {\n    const Authorization = req.cookies['Authorization'] || (req.header('Authorization') ? req.header('Authorization').split('Bearer ')[1] : null);\n\n    if (Authorization) {\n      const secretKey: string = SECRET_KEY;\n      const verificationResponse = (await verify(Authorization, secretKey)) as DataStoredInToken;\n      const userId = verificationResponse._id;\n      const findUser = await userModel.findById(userId);\n\n      if (findUser) {\n        req.user = findUser;\n        next();\n      } else {\n        next(new HttpException(401, 'Wrong authentication token'));\n      }\n    } else {\n      next(new HttpException(404, 'Authentication token missing'));\n    }\n  } catch (error) {\n    next(new HttpException(401, 'Wrong authentication token'));\n  }\n};\n\nexport default authMiddleware;\n"],"names":["verify","SECRET_KEY","HttpException","userModel","authMiddleware","req","res","next","Authorization","secretKey","verificationResponse","userId","findUser","error","cookies","header","split","_id","findById","user"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,SAASA,MAAM,QAAQ,eAAe;AACtC,SAASC,UAAU,QAAQ,UAAU;AACrC,SAASC,aAAa,QAAQ,4BAA4B;AAE1D,OAAOC,eAAe,sBAAsB;AAE5C,IAAMC;eAAiB,oBAAA,SAAOC,KAAsBC,KAAeC;YAEzDC,eAGEC,WACAC,sBACAC,QACAC,UAWDC;;;;;;;;;;oBAjBDL,gBAAgBH,IAAIS,OAAO,CAAC,gBAAgB,IAAKT,CAAAA,IAAIU,MAAM,CAAC,mBAAmBV,IAAIU,MAAM,CAAC,iBAAiBC,KAAK,CAAC,UAAU,CAAC,EAAE,GAAG,IAAG;yBAEtIR,eAAAA;;;;oBACIC,YAAoBR;oBACI;;wBAAMD,OAAOQ,eAAeC;;;oBAApDC,uBAAwB;oBACxBC,SAASD,qBAAqBO,GAAG;oBACtB;;wBAAMd,UAAUe,QAAQ,CAACP;;;oBAApCC,WAAW;oBAEjB,IAAIA,UAAU;wBACZP,IAAIc,IAAI,GAAGP;wBACXL;oBACF,OAAO;wBACLA,KAAK,IAAIL,cAAc,KAAK;oBAC9B;;;;;;oBAEAK,KAAK,IAAIL,cAAc,KAAK;;;;;;;;oBAEvBW;oBACPN,KAAK,IAAIL,cAAc,KAAK;;;;;;;;;;;IAEhC;oBAtBME,eAAwBC,KAAsBC,KAAeC;;;;AAwBnE,eAAeH,eAAe"}