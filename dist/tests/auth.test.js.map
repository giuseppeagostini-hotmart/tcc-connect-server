{"version":3,"sources":["../../src/tests/auth.test.ts"],"sourcesContent":["import bcrypt from 'bcrypt';\nimport mongoose from 'mongoose';\nimport request from 'supertest';\nimport App from '@/app';\nimport { CreateUserDto } from '@dtos/users.dto';\nimport AuthRoute from '@routes/auth.route';\n\nafterAll(async () => {\n  await new Promise<void>(resolve => setTimeout(() => resolve(), 500));\n});\n\ndescribe('Testing Auth', () => {\n  describe('[POST] /signup', () => {\n    it('response should have the Create userData', async () => {\n      const userData: CreateUserDto = {\n        email: 'test@email.com',\n        password: 'q1w2e3r4!',\n      };\n\n      const authRoute = new AuthRoute();\n      const users = authRoute.authController.authService.users;\n\n      users.findOne = jest.fn().mockReturnValue(null);\n      users.create = jest.fn().mockReturnValue({\n        _id: '60706478aad6c9ad19a31c84',\n        email: userData.email,\n        password: await bcrypt.hash(userData.password, 10),\n      });\n\n      (mongoose as any).connect = jest.fn();\n      const app = new App([authRoute]);\n      return request(app.getServer()).post(`${authRoute.path}signup`).send(userData);\n    });\n  });\n\n  describe('[POST] /login', () => {\n    it('response should have the Set-Cookie header with the Authorization token', async () => {\n      const userData: CreateUserDto = {\n        email: 'test@email.com',\n        password: 'q1w2e3r4!',\n      };\n\n      const authRoute = new AuthRoute();\n      const users = authRoute.authController.authService.users;\n\n      users.findOne = jest.fn().mockReturnValue({\n        _id: '60706478aad6c9ad19a31c84',\n        email: userData.email,\n        password: await bcrypt.hash(userData.password, 10),\n      });\n\n      (mongoose as any).connect = jest.fn();\n      const app = new App([authRoute]);\n      return request(app.getServer())\n        .post(`${authRoute.path}login`)\n        .send(userData)\n        .expect('Set-Cookie', /^Authorization=.+/);\n    });\n  });\n\n  // describe('[POST] /logout', () => {\n  //   it('logout Set-Cookie Authorization=; Max-age=0', async () => {\n  //     const userData: User = {\n  //       _id: '60706478aad6c9ad19a31c84',\n  //       email: 'test@email.com',\n  //       password: await bcrypt.hash('q1w2e3r4!', 10),\n  //     };\n\n  //     const authRoute = new AuthRoute();\n  //     const users = authRoute.authController.authService.users;\n\n  //     users.findOne = jest.fn().mockReturnValue(userData);\n\n  //     (mongoose as any).connect = jest.fn();\n  //     const app = new App([authRoute]);\n  //     return request(app.getServer())\n  //       .post(`${authRoute.path}logout`)\n  //       .send(userData)\n  //       .set('Set-Cookie', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ')\n  //       .expect('Set-Cookie', /^Authorization=\\; Max-age=0/);\n  //   });\n  // });\n});\n"],"names":["bcrypt","mongoose","request","App","AuthRoute","afterAll","Promise","resolve","setTimeout","describe","it","userData","authRoute","users","app","email","password","authController","authService","findOne","jest","fn","mockReturnValue","_id","hash","create","connect","getServer","post","path","send","expect"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,YAAY,SAAS;AAC5B,OAAOC,cAAc,WAAW;AAChC,OAAOC,aAAa,YAAY;AAChC,OAAOC,SAAS,QAAQ;AAExB,OAAOC,eAAe,qBAAqB;AAE3CC,uBAAS,oBAAA;;;;gBACP;;oBAAM,IAAIC,QAAcC,SAAAA;+BAAWC,WAAW;mCAAMD;2BAAW;;;;gBAA/D;;;;;;AACF;AAEAE,SAAS,gBAAgB;IACvBA,SAAS,kBAAkB;QACzBC,GAAG,0DAA4C,oBAAA;gBACvCC,UAKAC,WACAC,oBAUAC;;;;wBAhBAH,WAA0B;4BAC9BI,OAAO;4BACPC,UAAU;wBACZ;wBAEMJ,YAAY,IAAIR;wBAChBS,QAAQD,UAAUK,cAAc,CAACC,WAAW,CAACL,KAAK;wBAExDA,MAAMM,OAAO,GAAGC,KAAKC,EAAE,GAAGC,eAAe,CAAC;6BAC3BF,KAAAA,KAAKC,EAAE,IAAGC,eAAe;;4BACtCC,KAAK;4BACLR,OAAOJ,SAASI,KAAK;;wBACX;;4BAAMf,OAAOwB,IAAI,CAACb,SAASK,QAAQ,EAAE;;;wBAHjDH,MAAMY,MAAM,GAAGL,GAAAA;kCAGbJ,WAAU;;wBAGXf,SAAiByB,OAAO,GAAGN,KAAKC,EAAE;wBAC7BP,MAAM,IAAIX;4BAAKS;;wBACrB;;4BAAOV,QAAQY,IAAIa,SAAS,IAAIC,IAAI,CAAC,AAAC,GAAiB,OAAfhB,UAAUiB,IAAI,EAAC,WAASC,IAAI,CAACnB;;;;QACvE;IACF;IAEAF,SAAS,iBAAiB;QACxBC,GAAG,yFAA2E,oBAAA;gBACtEC,UAKAC,WACAC,oBASAC;;;;wBAfAH,WAA0B;4BAC9BI,OAAO;4BACPC,UAAU;wBACZ;wBAEMJ,YAAY,IAAIR;wBAChBS,QAAQD,UAAUK,cAAc,CAACC,WAAW,CAACL,KAAK;6BAExCO,KAAAA,KAAKC,EAAE,IAAGC,eAAe;;4BACvCC,KAAK;4BACLR,OAAOJ,SAASI,KAAK;;wBACX;;4BAAMf,OAAOwB,IAAI,CAACb,SAASK,QAAQ,EAAE;;;wBAHjDH,MAAMM,OAAO,GAAGC,GAAAA;kCAGdJ,WAAU;;wBAGXf,SAAiByB,OAAO,GAAGN,KAAKC,EAAE;wBAC7BP,MAAM,IAAIX;4BAAKS;;wBACrB;;4BAAOV,QAAQY,IAAIa,SAAS,IACzBC,IAAI,CAAC,AAAC,GAAiB,OAAfhB,UAAUiB,IAAI,EAAC,UACvBC,IAAI,CAACnB,UACLoB,MAAM,CAAC,cAAc;;;;QAC1B;IACF;AAEA,qCAAqC;AACrC,oEAAoE;AACpE,+BAA+B;AAC/B,yCAAyC;AACzC,iCAAiC;AACjC,sDAAsD;AACtD,SAAS;AAET,yCAAyC;AACzC,gEAAgE;AAEhE,2DAA2D;AAE3D,6CAA6C;AAC7C,wCAAwC;AACxC,sCAAsC;AACtC,yCAAyC;AACzC,wBAAwB;AACxB,kEAAkE;AAClE,8DAA8D;AAC9D,QAAQ;AACR,MAAM;AACR"}